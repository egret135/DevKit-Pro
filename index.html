<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevKit Pro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Fira+Code:wght@400;500&family=Source+Code+Pro:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- CodeMirror & Theme -->
    <link rel="stylesheet" href="lib/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="lib/codemirror/theme/dracula.css">
    <link rel="stylesheet" href="lib/codemirror/theme/material.css">
    <link rel="stylesheet" href="lib/codemirror/theme/monokai.css">
    <link rel="stylesheet" href="lib/codemirror/theme/eclipse.css">
    <link rel="stylesheet" href="lib/codemirror/theme/neo.css">
    <!-- Custom Editor Styles -->
    <style>
        .CodeMirror {
            height: 100%;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            border-radius: 6px;
        }

        .form-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 12px;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group.row {
            display: flex;
            gap: 16px;
        }

        .col {
            flex: 1;
        }

        .select.full-width {
            width: 100%;
        }
    </style>
</head>

<body>
    <!-- Main Container -->
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" />
                        <path d="M14 6l4 6-4 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <h1>DevKit Pro</h1>
                </div>
                <div class="header-actions">
                    <div class="mode-switcher">
                        <button id="modeConverter" class="mode-btn active">转换器</button>
                        <button id="modeDiff" class="mode-btn">DDL 对比</button>
                        <button id="modeMarkdown" class="mode-btn">Markdown</button>
                    </div>
                    <div class="separator"></div>

                    <!-- Converter Options -->
                    <div id="converterOptions" class="options-group">
                        <!-- Go Struct Options -->
                        <label class="checkbox-inline" id="goStructOptions">
                            <input type="checkbox" id="inlineNestedStructs" checked />
                            <span>内联嵌套</span>
                        </label>
                        <!-- Protocol Buffer Options -->
                        <select id="protoNestedMode" class="select hidden">
                            <option value="separate">独立声明</option>
                            <option value="inline">嵌套message</option>
                        </select>
                        <select id="dbType" class="select">
                            <option value="auto">自动检测</option>
                            <option value="mysql">MySQL</option>
                            <option value="postgresql">PostgreSQL</option>
                            <option value="sqlite">SQLite</option>
                            <option value="json">JSON</option>
                        </select>
                        <button id="settingsBtn" class="btn-icon" title="设置">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                                <path
                                    d="M12 1v3m0 16v3M23 12h-3M4 12H1M20.5 3.5l-2.1 2.1M5.6 18.4l-2.1 2.1M20.5 20.5l-2.1-2.1M5.6 5.6L3.5 3.5"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Converter Workspace -->
            <div id="converterWorkspace" class="workspace">
                <!-- Input Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>输入</span>
                            <span id="inputType" class="badge">未检测</span>
                        </div>
                        <div class="panel-actions">
                            <button id="clearBtn" class="btn-ghost">清除</button>
                            <button id="convertBtn" class="btn-primary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M5 12h14m-7-7l7 7-7 7" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                转换
                            </button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <textarea id="inputArea" class="editor"
                            placeholder="粘贴你的 DDL 或 JSON...&#10;&#10;示例：&#10;CREATE TABLE users (&#10;  id INT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',&#10;  username VARCHAR(100) NOT NULL COMMENT '用户名'&#10;);"
                            spellcheck="false"></textarea>
                    </div>
                </div>

                <!-- Output Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span id="outputTitle">输出</span>
                            <!-- Output format switcher -->
                            <div class="output-format-switcher">
                                <label>
                                    <input type="radio" name="outputFormat" value="go" id="outputFormatGo" checked />
                                    <span>Go Struct</span>
                                </label>
                                <label>
                                    <input type="radio" name="outputFormat" value="proto" id="outputFormatProto" />
                                    <span>Protocol Buffer</span>
                                </label>
                            </div>
                        </div>
                        <div class="panel-actions">
                            <button id="copyBtn" class="btn-ghost">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <rect x="8" y="8" width="13" height="13" rx="2" stroke="currentColor"
                                        stroke-width="2" />
                                    <path d="M5 16V5a2 2 0 0 1 2-2h11" stroke="currentColor" stroke-width="2" />
                                </svg>
                                复制
                            </button>
                            <button id="exportBtn" class="btn-ghost">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M12 3v12m-4-4l4 4 4-4M3 21h18" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                导出
                            </button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <textarea id="outputArea" class="editor output" spellcheck="false" readonly></textarea>
                    </div>
                </div>
            </div>

            <!-- Diff Workspace (Hidden by default) -->
            <div id="diffWorkspace" class="workspace hidden">
                <!-- Source/Target Panels (Left) -->
                <div class="panel vertical-split">
                    <!-- Target (Online) DDL -->
                    <div class="sub-panel">
                        <div class="panel-header">
                            <div class="panel-title">Online / 目标 DDL (旧)</div>
                            <button id="clearDiffBtn" class="btn-ghost">清空全部</button>
                        </div>
                        <div class="panel-body">
                            <textarea id="diffTargetInput" class="editor" placeholder="粘贴线上环境的 DDL (基准)..."
                                spellcheck="false"></textarea>
                        </div>
                    </div>
                    <!-- Source (Staging) DDL -->
                    <div class="sub-panel">
                        <div class="panel-header small">
                            <div class="panel-title">Staging / 本地 DDL (新)</div>
                        </div>
                        <div class="panel-body">
                            <textarea id="diffSourceInput" class="editor" placeholder="粘贴新开发的 DDL (变更后)..."
                                spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Diff Output Panel (Right) -->
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>ALTER 语句</span>
                        </div>
                        <div class="panel-actions">
                            <button id="copyDiffBtn" class="btn-ghost">复制 SQL</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <textarea id="diffOutputArea" class="editor output" spellcheck="false" readonly></textarea>
                    </div>
                </div>
            </div>

            <!-- Markdown Workspace (Hidden by default) -->
            <div id="markdownWorkspace" class="workspace hidden">
                <!-- Input Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>Markdown 输入</span>
                        </div>
                        <div class="panel-actions">
                            <button id="clearMarkdownBtn" class="btn-ghost">清除</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <textarea id="markdownInput" class="editor"
                            placeholder="输入 Markdown 文本...&#10;&#10;支持 Mermaid 图表：&#10;```mermaid&#10;flowchart TD&#10;    A[开始] --> B[结束]&#10;```"
                            spellcheck="false"></textarea>
                    </div>
                </div>

                <!-- Preview Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>渲染预览</span>
                        </div>
                        <div class="panel-actions">
                            <button id="copyMarkdownHtmlBtn" class="btn-ghost">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <rect x="8" y="8" width="13" height="13" rx="2" stroke="currentColor"
                                        stroke-width="2" />
                                    <path d="M5 16V5a2 2 0 0 1 2-2h11" stroke="currentColor" stroke-width="2" />
                                </svg>
                                复制 HTML
                            </button>
                            <div class="dropdown" id="exportMarkdownDropdown">
                                <button class="btn-ghost dropdown-trigger" id="exportMarkdownBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <path d="M12 3v12m-4-4l4 4 4-4M3 21h18" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    导出图片
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" class="dropdown-arrow">
                                        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </button>
                                <div class="dropdown-menu">
                                    <button class="dropdown-item" data-format="png">导出 PNG</button>
                                    <button class="dropdown-item" data-format="jpg">导出 JPG</button>
                                    <button class="dropdown-item" data-format="svg">导出 SVG</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body markdown-preview-container">
                        <div id="markdownPreview" class="markdown-preview">
                            <p class="placeholder">输入 Markdown 文本开始预览...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <span id="statusMessage" class="status">就绪</span>
                <span id="lineCount" class="info">0 行</span>
            </div>
        </footer>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-container">
                <div class="modal-header">
                    <h2>设置</h2>
                    <button id="closeModal" class="btn-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-section-title">外观</div>
                    <div class="form-group row">
                        <div class="col">
                            <label>主题</label>
                            <select id="editorTheme" class="select full-width">
                                <option value="dracula">Dracula (Dark)</option>
                                <option value="material">Material (Dark)</option>
                                <option value="monokai">Monokai (Dark)</option>
                                <option value="eclipse">Eclipse (Light)</option>
                                <option value="neo">Neo (Light)</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>字体</label>
                            <select id="editorFont" class="select full-width">
                                <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                                <option value="'Fira Code', monospace">Fira Code</option>
                                <option value="'Source Code Pro', monospace">Source Code Pro</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section-title">生成设置</div>
                    <div class="form-group">
                        <label>结构体名称</label>
                        <input type="text" id="structNameInput" class="input" placeholder="留空自动生成" />
                    </div>
                    <div class="form-group">
                        <label>包名</label>
                        <input type="text" id="packageNameInput" class="input" value="model" />
                    </div>
                    <div class="form-group">
                        <label class="checkbox">
                            <input type="checkbox" id="generateTableName" checked />
                            <span>生成 TableName() 方法</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveSettings" class="btn-primary">保存设置</button>
                </div>
            </div>
        </div>
    </div>

    <!-- External Libraries (Local) -->
    <script src="lib/marked.min.js"></script>
    <script src="lib/mermaid.min.js"></script>
    <script src="lib/html2canvas.min.js"></script>

    <!-- CodeMirror Libraries -->
    <script src="lib/codemirror/lib/codemirror.js"></script>
    <script src="lib/codemirror/mode/sql/sql.js"></script>
    <script src="lib/codemirror/mode/go/go.js"></script>
    <script src="lib/codemirror/mode/javascript/javascript.js"></script>
    <script src="lib/codemirror/mode/markdown/markdown.js"></script>

    <!-- Scripts -->
    <script src="utils/history-manager.js"></script>
    <script src="utils/editor-manager.js"></script>
    <script src="parsers/detector.js"></script>
    <script src="parsers/mysql-parser.js"></script>
    <script src="parsers/postgresql-parser.js"></script>
    <script src="parsers/sqlite-parser.js"></script>
    <script src="parsers/json-parser.js"></script>
    <script src="parsers/protobuf-parser.js"></script>
    <script src="utils/type-mapper.js"></script>
    <script src="utils/protobuf-type-mapper.js"></script>
    <script src="utils/formatter.js"></script>
    <script src="utils/exporter.js"></script>
    <script src="generators/struct-generator.js"></script>
    <script src="generators/protobuf-generator.js"></script>
    <script src="generators/diff-engine.js"></script>
    <script src="parsers/markdown-renderer.js"></script>
    <script src="utils/chart-exporter.js"></script>
    <script src="utils/markdown-exporter.js"></script>
    <script src="config/settings.js"></script>
    <script src="app.js"></script>
</body>

</html>